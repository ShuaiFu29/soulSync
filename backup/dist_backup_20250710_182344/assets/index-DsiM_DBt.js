import{j as e,B as k,P as A}from"./index-CrL0uE7V.js";import{r as h}from"./router-DMDMz4SB.js";import"./vendor-DJG_os-6.js";const O=({onSubmit:j,currentUser:N,className:b=""})=>{const[i,f]=h.useState({content:"",tags:"",isAnonymous:!1}),[u,w]=h.useState(!1),[v,x]=h.useState(0),[d,g]=h.useState({}),n=500,s=5,l=o=>{const{name:r,value:m,type:L,checked:a}=o.target;r==="content"?m.length<=n&&(f(t=>({...t,[r]:m})),x(m.length)):f(t=>({...t,[r]:L==="checkbox"?a:m})),d[r]&&g(t=>({...t,[r]:""}))},c=()=>{const o={};return i.content.trim()?i.content.trim().length<5&&(o.content="ç•™è¨€å†…å®¹è‡³å°‘éœ€è¦5ä¸ªå­—ç¬¦"):o.content="è¯·è¾“å…¥ç•™è¨€å†…å®¹",i.tags&&i.tags.split(",").map(m=>m.trim()).filter(m=>m).length>s&&(o.tags=`æœ€å¤šåªèƒ½æ·»åŠ ${s}ä¸ªæ ‡ç­¾`),g(o),Object.keys(o).length===0},y=async o=>{if(o.preventDefault(),!(!c()||u)){w(!0);try{const r={content:i.content.trim(),author:i.isAnonymous?"åŒ¿åç”¨æˆ·":N?.name||"æ¸¸å®¢",timestamp:new Date().toISOString(),tags:i.tags?i.tags.split(",").map(m=>m.trim()).filter(m=>m):[],avatar:i.isAnonymous?null:N?.avatar,likes:0,isLiked:!1,replies:[]};await j?.(r),f({content:"",tags:"",isAnonymous:!1}),x(0),g({})}catch(r){console.error("å‘å¸ƒç•™è¨€å¤±è´¥:",r),g({general:"å‘å¸ƒå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"})}finally{w(!1)}}},D=o=>{const r=i.content+o;r.length<=n&&(f(m=>({...m,content:r})),x(r.length))},S=["ðŸ˜Š","ðŸ˜","ðŸ¥°","ðŸ˜Ž","ðŸ¤”","ðŸ˜‚","ðŸ‘","â¤ï¸","ðŸ”¥","â­"];return e.jsx("div",{className:`message-form-container ${b}`,children:e.jsxs("div",{className:"message-form card-glass",children:[e.jsxs("div",{className:"form-header",children:[e.jsx("h3",{className:"form-title",children:"ðŸ’¬ åˆ†äº«ä½ çš„æƒ³æ³•"}),e.jsx("p",{className:"form-subtitle",children:"ä¸Žè¿åŠ¨ä¼™ä¼´ä»¬åˆ†äº«ä½ çš„æ„Ÿå—å’Œæƒ³æ³•"})]}),e.jsxs("form",{onSubmit:y,className:"message-form-content",children:[d.general&&e.jsx("div",{className:"error-message",children:d.general}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"ç•™è¨€å†…å®¹ *"}),e.jsx("textarea",{id:"content",name:"content",value:i.content,onChange:l,className:`form-textarea input-glass ${d.content?"error":""}`,placeholder:"åˆ†äº«ä½ çš„è¿åŠ¨å¿ƒå¾—ã€æ„Ÿå—æˆ–è€…é—®é¢˜...",rows:4,maxLength:n}),e.jsxs("div",{className:"textarea-footer",children:[e.jsx("div",{className:"char-count",children:e.jsxs("span",{className:v>n*.9?"warning":"",children:[v,"/",n]})}),d.content&&e.jsx("span",{className:"field-error",children:d.content})]})]}),e.jsxs("div",{className:"emoji-picker",children:[e.jsx("span",{className:"emoji-label",children:"å¿«é€Ÿæ’å…¥è¡¨æƒ…ï¼š"}),e.jsx("div",{className:"emoji-list",children:S.map((o,r)=>e.jsx("button",{type:"button",className:"emoji-btn",onClick:()=>D(o),disabled:v>=n,children:o},r))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tags",className:"form-label",children:"æ ‡ç­¾ (å¯é€‰)"}),e.jsx("input",{type:"text",id:"tags",name:"tags",value:i.tags,onChange:l,className:`form-input input-glass ${d.tags?"error":""}`,placeholder:"è¿åŠ¨ç±»åž‹, å¿ƒæƒ…, æ„Ÿå— (ç”¨é€—å·åˆ†éš”ï¼Œæœ€å¤š5ä¸ª)"}),d.tags&&e.jsx("span",{className:"field-error",children:d.tags}),e.jsx("div",{className:"tags-hint",children:"ä¾‹å¦‚ï¼šè·‘æ­¥, å¿«ä¹, å¥åº·"})]}),e.jsx("div",{className:"form-options",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isAnonymous",checked:i.isAnonymous,onChange:l,className:"checkbox-input"}),e.jsx("span",{className:"checkbox-custom"}),"åŒ¿åå‘å¸ƒ"]})}),e.jsxs("div",{className:"form-actions",children:[e.jsx(k,{type:"button",variant:"ghost",size:"medium",onClick:()=>{f({content:"",tags:"",isAnonymous:!1}),x(0),g({})},disabled:u,children:"æ¸…ç©º"}),e.jsx(k,{type:"submit",variant:"primary",size:"medium",disabled:u||!i.content.trim(),className:u?"loading":"",children:u?"å‘å¸ƒä¸­...":"å‘å¸ƒç•™è¨€"})]})]})]})})},z=({message:j,onLike:N,onReply:b,currentUser:i=null,className:f=""})=>{const[u,w]=h.useState(!1),[v,x]=h.useState(""),[d,g]=h.useState(!1),{id:n,author:s,content:l,timestamp:c,likes:y=0,isLiked:D=!1,replies:S=[],tags:o=[],avatar:r}=j,m=async()=>{if(!d){g(!0);try{await N?.(n)}finally{g(!1)}}},L=async t=>{if(t.preventDefault(),!!v.trim())try{await b?.(n,{content:v,author:i?.name||"åŒ¿åç”¨æˆ·",timestamp:new Date().toISOString()}),x(""),w(!1)}catch(p){console.error("å›žå¤å¤±è´¥:",p)}},a=t=>{const p=new Date(t),C=new Date-p,M=Math.floor(C/6e4),I=Math.floor(C/36e5),$=Math.floor(C/864e5);return M<1?"åˆšåˆš":M<60?`${M}åˆ†é’Ÿå‰`:I<24?`${I}å°æ—¶å‰`:$<7?`${$}å¤©å‰`:p.toLocaleDateString("zh-CN")};return e.jsxs("div",{className:`message-card card-glass hover-lift ${f}`,children:[e.jsx("div",{className:"message-header",children:e.jsxs("div",{className:"author-info",children:[e.jsx("div",{className:"author-avatar",children:r?e.jsx("img",{src:r,alt:s}):e.jsx("div",{className:"avatar-placeholder",children:s?.charAt(0)?.toUpperCase()||"?"})}),e.jsxs("div",{className:"author-details",children:[e.jsx("h4",{className:"author-name",children:s||"åŒ¿åç”¨æˆ·"}),e.jsx("span",{className:"message-time",children:a(c)})]})]})}),e.jsxs("div",{className:"message-content",children:[e.jsx("p",{children:l}),o.length>0&&e.jsx("div",{className:"message-tags",children:o.map((t,p)=>e.jsxs("span",{className:"tag",children:["#",t]},p))})]}),e.jsxs("div",{className:"message-actions",children:[e.jsxs(k,{variant:"ghost",size:"small",onClick:m,disabled:d,className:`like-btn ${D?"liked":""}`,children:[e.jsx("span",{className:"like-icon",children:D?"â¤ï¸":"ðŸ¤"}),e.jsx("span",{className:"like-count",children:y})]}),e.jsxs(k,{variant:"ghost",size:"small",onClick:()=>w(!u),className:"reply-btn",children:[e.jsx("span",{className:"reply-icon",children:"ðŸ’¬"}),"å›žå¤"]})]}),S.length>0&&e.jsxs("div",{className:"message-replies",children:[e.jsxs("h5",{className:"replies-title",children:["å›žå¤ (",S.length,")"]}),S.map((t,p)=>e.jsxs("div",{className:"reply-item",children:[e.jsxs("div",{className:"reply-author",children:[t.author,":"]}),e.jsx("div",{className:"reply-content",children:t.content}),e.jsx("div",{className:"reply-time",children:a(t.timestamp)})]},p))]}),u&&e.jsxs("form",{onSubmit:L,className:"reply-form",children:[e.jsx("textarea",{value:v,onChange:t=>x(t.target.value),placeholder:"å†™ä¸‹ä½ çš„å›žå¤...",className:"reply-textarea input-glass",rows:3,required:!0}),e.jsxs("div",{className:"reply-form-actions",children:[e.jsx(k,{type:"button",variant:"ghost",size:"small",onClick:()=>{w(!1),x("")},children:"å–æ¶ˆ"}),e.jsx(k,{type:"submit",variant:"primary",size:"small",disabled:!v.trim(),children:"å‘é€å›žå¤"})]})]})]})},F=({messages:j=[],onLoadMore:N,onLike:b,onReply:i,currentUser:f,loading:u=!1,hasMore:w=!1,className:v=""})=>{const[x,d]=h.useState("latest"),[g,n]=h.useState("all"),[s,l]=h.useState(""),[c,y]=h.useState(j);h.useEffect(()=>{let a=[...j];switch(s.trim()&&(a=a.filter(t=>t.content.toLowerCase().includes(s.toLowerCase())||t.author.toLowerCase().includes(s.toLowerCase())||t.tags?.some(p=>p.toLowerCase().includes(s.toLowerCase())))),g){case"own":a=a.filter(t=>t.author===f?.name||f?.isAnonymous&&t.author==="åŒ¿åç”¨æˆ·");break}switch(x){case"popular":a.sort((t,p)=>(p.likes||0)-(t.likes||0));break;case"oldest":a.sort((t,p)=>new Date(t.timestamp)-new Date(p.timestamp));break;default:a.sort((t,p)=>new Date(p.timestamp)-new Date(t.timestamp));break}y(a)},[j,s,x,g,f]);const D=a=>{l(a.target.value)},S=a=>{d(a)},o=a=>{n(a)},r=()=>{l(""),d("latest"),n("all")},m=a=>({latest:"æœ€æ–°",popular:"æœ€çƒ­",oldest:"æœ€æ—©"})[a]||"æœ€æ–°",L=a=>({all:"å…¨éƒ¨",followed:"å…³æ³¨",own:"æˆ‘çš„"})[a]||"å…¨éƒ¨";return j.length===0&&!u?e.jsx("div",{className:`message-list ${v}`,children:e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ðŸ’¬"}),e.jsx("h3",{children:"è¿˜æ²¡æœ‰ç•™è¨€"}),e.jsx("p",{children:"æˆä¸ºç¬¬ä¸€ä¸ªåˆ†äº«æƒ³æ³•çš„äººå§ï¼"})]})}):e.jsxs("div",{className:`message-list ${v}`,children:[e.jsxs("div",{className:"message-toolbar",children:[e.jsx("div",{className:"search-section",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("input",{type:"text",value:s,onChange:D,placeholder:"æœç´¢ç•™è¨€å†…å®¹ã€ä½œè€…æˆ–æ ‡ç­¾...",className:"search-input input-glass"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]})}),e.jsxs("div",{className:"filter-section",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"æŽ’åºï¼š"}),e.jsx("div",{className:"filter-buttons",children:["latest","popular","oldest"].map(a=>e.jsx(k,{variant:x===a?"primary":"ghost",size:"small",onClick:()=>S(a),className:"filter-btn",children:m(a)},a))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"ç­›é€‰ï¼š"}),e.jsx("div",{className:"filter-buttons",children:["all","followed","own"].map(a=>e.jsx(k,{variant:g===a?"primary":"ghost",size:"small",onClick:()=>o(a),className:"filter-btn",children:L(a)},a))})]}),(s||x!=="latest"||g!=="all")&&e.jsx(k,{variant:"outline",size:"small",onClick:r,className:"clear-filters-btn",children:"æ¸…é™¤ç­›é€‰"})]})]}),e.jsx("div",{className:"results-info",children:e.jsxs("span",{className:"results-count",children:["å…± ",c.length," æ¡ç•™è¨€",s&&` Â· æœç´¢"${s}"`]})}),e.jsx("div",{className:"messages-container",children:c.length===0?e.jsxs("div",{className:"no-results",children:[e.jsx("div",{className:"no-results-icon",children:"ðŸ”"}),e.jsx("h3",{children:"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç•™è¨€"}),e.jsx("p",{children:"è¯•è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰é€‰é¡¹"}),e.jsx(k,{variant:"outline",size:"medium",onClick:r,children:"æ¸…é™¤æ‰€æœ‰ç­›é€‰"})]}):c.map((a,t)=>e.jsx(z,{message:a,onLike:b,onReply:i,currentUser:f,className:`message-item-${t}`},a.id||t))}),w&&e.jsx("div",{className:"load-more-section",children:e.jsx(k,{variant:"outline",size:"large",onClick:N,disabled:u,className:`load-more-btn ${u?"loading":""}`,children:u?"åŠ è½½ä¸­...":"åŠ è½½æ›´å¤šç•™è¨€"})}),u&&e.jsxs("div",{className:"loading-indicator",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½ç•™è¨€..."})]})]})},B=()=>{const[j,N]=h.useState([]),[b,i]=h.useState(!1),[f,u]=h.useState(!0),[w]=h.useState({name:"è¿åŠ¨çˆ±å¥½è€…",avatar:null,id:"user_123"});h.useEffect(()=>{const n=[{id:"1",author:"å°æ˜Ž",content:"ä»Šå¤©è·‘äº†10å…¬é‡Œï¼Œæ„Ÿè§‰è¶…æ£’ï¼è¿åŠ¨çœŸçš„æ˜¯æœ€å¥½çš„è§£åŽ‹æ–¹å¼ï¼ŒæŽ¨èå¤§å®¶éƒ½è¯•è¯•æ™¨è·‘ï¼Œç©ºæ°”æ¸…æ–°ï¼Œå¿ƒæƒ…ä¹Ÿä¼šå˜å¾—å¾ˆå¥½ã€‚",timestamp:new Date(Date.now()-18e5).toISOString(),likes:15,isLiked:!1,replies:[{author:"å°çº¢",content:"æˆ‘ä¹Ÿå–œæ¬¢æ™¨è·‘ï¼ä¸€èµ·ç»„é˜Ÿå§",timestamp:new Date(Date.now()-12e5).toISOString()}],tags:["è·‘æ­¥","å¥åº·","æ™¨ç»ƒ"],avatar:null},{id:"2",author:"å¥èº«è¾¾äºº",content:"åˆšä»Žå¥èº«æˆ¿å›žæ¥ï¼Œä»Šå¤©ç»ƒçš„æ˜¯èƒ¸è‚Œå’Œä¸‰å¤´ã€‚æ„Ÿè§‰çŠ¶æ€è¶Šæ¥è¶Šå¥½äº†ï¼ŒåšæŒçœŸçš„å¾ˆé‡è¦ï¼ðŸ’ª",timestamp:new Date(Date.now()-72e5).toISOString(),likes:8,isLiked:!0,replies:[],tags:["å¥èº«","è‚Œè‚‰è®­ç»ƒ"],avatar:null},{id:"3",author:"ç‘œä¼½çˆ±å¥½è€…",content:"ä»Šå¤©çš„ç‘œä¼½è¯¾ç‰¹åˆ«æ£’ï¼Œè€å¸ˆæ•™äº†ä¸€äº›æ–°çš„ä½“å¼ã€‚ç‘œä¼½ä¸ä»…èƒ½é”»ç‚¼èº«ä½“ï¼Œè¿˜èƒ½è®©å¿ƒçµå¾—åˆ°å¹³é™ã€‚æŽ¨èå¤§å®¶å°è¯•ï¼",timestamp:new Date(Date.now()-18e6).toISOString(),likes:12,isLiked:!1,replies:[{author:"å°æŽ",content:"ç‘œä¼½ç¡®å®žå¾ˆæ£’ï¼Œæˆ‘ä¹Ÿåœ¨å­¦",timestamp:new Date(Date.now()-144e5).toISOString()},{author:"è¿åŠ¨å°ç™½",content:"è¯·é—®æœ‰æŽ¨èçš„ç‘œä¼½æ•™ç¨‹å—ï¼Ÿ",timestamp:new Date(Date.now()-108e5).toISOString()}],tags:["ç‘œä¼½","æ”¾æ¾","èº«å¿ƒå¥åº·"],avatar:null},{id:"4",author:"åŒ¿åç”¨æˆ·",content:"åˆšå¼€å§‹è¿åŠ¨ï¼Œæœ‰ç‚¹ç´¯ä½†æ˜¯å¾ˆå……å®žã€‚å¸Œæœ›èƒ½åšæŒä¸‹åŽ»ï¼Œå¤§å®¶æœ‰ä»€ä¹ˆå»ºè®®å—ï¼Ÿ",timestamp:new Date(Date.now()-288e5).toISOString(),likes:6,isLiked:!1,replies:[],tags:["æ–°æ‰‹","åšæŒ"],avatar:null},{id:"5",author:"æ¸¸æ³³æ•™ç»ƒ",content:"æ¸¸æ³³æ˜¯å…¨èº«è¿åŠ¨ï¼Œå¯¹å…³èŠ‚åŽ‹åŠ›å°ï¼Œç‰¹åˆ«é€‚åˆæƒ³è¦å‡é‡å’Œå¡‘å½¢çš„æœ‹å‹ã€‚å¤å¤©æ¸¸æ³³æ—¢é”»ç‚¼åˆå‡‰çˆ½ï¼",timestamp:new Date(Date.now()-432e5).toISOString(),likes:20,isLiked:!1,replies:[{author:"å°çŽ‹",content:"æ¸¸æ³³ç¡®å®žå¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘ä¸å¤ªä¼š",timestamp:new Date(Date.now()-36e6).toISOString()}],tags:["æ¸¸æ³³","å‡é‡","å…¨èº«è¿åŠ¨"],avatar:null}];N(n)},[]);const v=async n=>{try{i(!0),await new Promise(l=>setTimeout(l,1e3));const s={...n,id:Date.now().toString(),likes:0,isLiked:!1,replies:[]};N(l=>[s,...l])}catch(s){throw console.error("å‘å¸ƒç•™è¨€å¤±è´¥:",s),s}finally{i(!1)}},x=async n=>{try{N(s=>s.map(l=>l.id===n?{...l,isLiked:!l.isLiked,likes:l.isLiked?l.likes-1:l.likes+1}:l)),await new Promise(s=>setTimeout(s,500))}catch(s){console.error("ç‚¹èµžå¤±è´¥:",s),N(l=>l.map(c=>c.id===n?{...c,isLiked:!c.isLiked,likes:c.isLiked?c.likes+1:c.likes-1}:c))}},d=async(n,s)=>{try{const l={...s,id:Date.now().toString()};N(c=>c.map(y=>y.id===n?{...y,replies:[...y.replies||[],l]}:y)),await new Promise(c=>setTimeout(c,500))}catch(l){throw console.error("å›žå¤å¤±è´¥:",l),l}},g=async()=>{try{i(!0),await new Promise(s=>setTimeout(s,1e3));const n=[{id:`${Date.now()}-1`,author:"ç¯®çƒå°å­",content:"ä»Šå¤©å’Œæœ‹å‹ä»¬æ‰“äº†ä¸¤å°æ—¶ç¯®çƒï¼Œå‡ºäº†ä¸€èº«æ±—ï¼Œæ„Ÿè§‰çœŸçˆ½ï¼",timestamp:new Date(Date.now()-1e3*60*60*24).toISOString(),likes:3,isLiked:!1,replies:[],tags:["ç¯®çƒ","å›¢é˜Ÿè¿åŠ¨"],avatar:null},{id:`${Date.now()}-2`,author:"ç™»å±±å®¢",content:"å‘¨æœ«çˆ¬å±±çœ‹æ—¥å‡ºï¼Œè™½ç„¶ç´¯ä½†æ˜¯é£Žæ™¯çœŸçš„å¾ˆç¾Žã€‚è¿åŠ¨è®©æˆ‘ä»¬æ›´æŽ¥è¿‘å¤§è‡ªç„¶ï¼",timestamp:new Date(Date.now()-1e3*60*60*30).toISOString(),likes:7,isLiked:!1,replies:[],tags:["ç™»å±±","æˆ·å¤–","æ—¥å‡º"],avatar:null}];N(s=>[...s,...n]),j.length>15&&u(!1)}catch(n){console.error("åŠ è½½æ›´å¤šå¤±è´¥:",n)}finally{i(!1)}};return e.jsx(A,{backgroundIntensity:"light",className:"message-wall-page",children:e.jsxs("div",{className:"message-wall-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title gradient-text",children:"ðŸƒâ€â™‚ï¸ è¿åŠ¨ç•™è¨€å¢™"}),e.jsx("p",{className:"page-subtitle",children:"åˆ†äº«ä½ çš„è¿åŠ¨å¿ƒå¾—ï¼Œä¸Žä¼™ä¼´ä»¬ä¸€èµ·æˆé•¿"})]}),e.jsxs("div",{className:"message-wall-content",children:[e.jsx(O,{onSubmit:v,currentUser:w,className:"message-form-section"}),e.jsx(F,{messages:j,onLoadMore:g,onLike:x,onReply:d,currentUser:w,loading:b,hasMore:f,className:"message-list-section"})]}),e.jsxs("div",{className:"page-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-number",children:j.length}),e.jsx("span",{className:"stat-label",children:"æ¡ç•™è¨€"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-number",children:j.reduce((n,s)=>n+(s.replies?.length||0),0)}),e.jsx("span",{className:"stat-label",children:"æ¡å›žå¤"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-number",children:j.reduce((n,s)=>n+(s.likes||0),0)}),e.jsx("span",{className:"stat-label",children:"ä¸ªç‚¹èµž"})]})]})]})})};export{B as default};
