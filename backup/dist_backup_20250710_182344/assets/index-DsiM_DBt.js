import{j as e,B as k,P as A}from"./index-CrL0uE7V.js";import{r as h}from"./router-DMDMz4SB.js";import"./vendor-DJG_os-6.js";const O=({onSubmit:j,currentUser:N,className:b=""})=>{const[i,f]=h.useState({content:"",tags:"",isAnonymous:!1}),[u,w]=h.useState(!1),[v,x]=h.useState(0),[d,g]=h.useState({}),n=500,s=5,l=o=>{const{name:r,value:m,type:L,checked:a}=o.target;r==="content"?m.length<=n&&(f(t=>({...t,[r]:m})),x(m.length)):f(t=>({...t,[r]:L==="checkbox"?a:m})),d[r]&&g(t=>({...t,[r]:""}))},c=()=>{const o={};return i.content.trim()?i.content.trim().length<5&&(o.content="留言内容至少需要5个字符"):o.content="请输入留言内容",i.tags&&i.tags.split(",").map(m=>m.trim()).filter(m=>m).length>s&&(o.tags=`最多只能添加${s}个标签`),g(o),Object.keys(o).length===0},y=async o=>{if(o.preventDefault(),!(!c()||u)){w(!0);try{const r={content:i.content.trim(),author:i.isAnonymous?"匿名用户":N?.name||"游客",timestamp:new Date().toISOString(),tags:i.tags?i.tags.split(",").map(m=>m.trim()).filter(m=>m):[],avatar:i.isAnonymous?null:N?.avatar,likes:0,isLiked:!1,replies:[]};await j?.(r),f({content:"",tags:"",isAnonymous:!1}),x(0),g({})}catch(r){console.error("发布留言失败:",r),g({general:"发布失败，请稍后重试"})}finally{w(!1)}}},D=o=>{const r=i.content+o;r.length<=n&&(f(m=>({...m,content:r})),x(r.length))},S=["😊","😍","🥰","😎","🤔","😂","👍","❤️","🔥","⭐"];return e.jsx("div",{className:`message-form-container ${b}`,children:e.jsxs("div",{className:"message-form card-glass",children:[e.jsxs("div",{className:"form-header",children:[e.jsx("h3",{className:"form-title",children:"💬 分享你的想法"}),e.jsx("p",{className:"form-subtitle",children:"与运动伙伴们分享你的感受和想法"})]}),e.jsxs("form",{onSubmit:y,className:"message-form-content",children:[d.general&&e.jsx("div",{className:"error-message",children:d.general}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"留言内容 *"}),e.jsx("textarea",{id:"content",name:"content",value:i.content,onChange:l,className:`form-textarea input-glass ${d.content?"error":""}`,placeholder:"分享你的运动心得、感受或者问题...",rows:4,maxLength:n}),e.jsxs("div",{className:"textarea-footer",children:[e.jsx("div",{className:"char-count",children:e.jsxs("span",{className:v>n*.9?"warning":"",children:[v,"/",n]})}),d.content&&e.jsx("span",{className:"field-error",children:d.content})]})]}),e.jsxs("div",{className:"emoji-picker",children:[e.jsx("span",{className:"emoji-label",children:"快速插入表情："}),e.jsx("div",{className:"emoji-list",children:S.map((o,r)=>e.jsx("button",{type:"button",className:"emoji-btn",onClick:()=>D(o),disabled:v>=n,children:o},r))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tags",className:"form-label",children:"标签 (可选)"}),e.jsx("input",{type:"text",id:"tags",name:"tags",value:i.tags,onChange:l,className:`form-input input-glass ${d.tags?"error":""}`,placeholder:"运动类型, 心情, 感受 (用逗号分隔，最多5个)"}),d.tags&&e.jsx("span",{className:"field-error",children:d.tags}),e.jsx("div",{className:"tags-hint",children:"例如：跑步, 快乐, 健康"})]}),e.jsx("div",{className:"form-options",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"isAnonymous",checked:i.isAnonymous,onChange:l,className:"checkbox-input"}),e.jsx("span",{className:"checkbox-custom"}),"匿名发布"]})}),e.jsxs("div",{className:"form-actions",children:[e.jsx(k,{type:"button",variant:"ghost",size:"medium",onClick:()=>{f({content:"",tags:"",isAnonymous:!1}),x(0),g({})},disabled:u,children:"清空"}),e.jsx(k,{type:"submit",variant:"primary",size:"medium",disabled:u||!i.content.trim(),className:u?"loading":"",children:u?"发布中...":"发布留言"})]})]})]})})},z=({message:j,onLike:N,onReply:b,currentUser:i=null,className:f=""})=>{const[u,w]=h.useState(!1),[v,x]=h.useState(""),[d,g]=h.useState(!1),{id:n,author:s,content:l,timestamp:c,likes:y=0,isLiked:D=!1,replies:S=[],tags:o=[],avatar:r}=j,m=async()=>{if(!d){g(!0);try{await N?.(n)}finally{g(!1)}}},L=async t=>{if(t.preventDefault(),!!v.trim())try{await b?.(n,{content:v,author:i?.name||"匿名用户",timestamp:new Date().toISOString()}),x(""),w(!1)}catch(p){console.error("回复失败:",p)}},a=t=>{const p=new Date(t),C=new Date-p,M=Math.floor(C/6e4),I=Math.floor(C/36e5),$=Math.floor(C/864e5);return M<1?"刚刚":M<60?`${M}分钟前`:I<24?`${I}小时前`:$<7?`${$}天前`:p.toLocaleDateString("zh-CN")};return e.jsxs("div",{className:`message-card card-glass hover-lift ${f}`,children:[e.jsx("div",{className:"message-header",children:e.jsxs("div",{className:"author-info",children:[e.jsx("div",{className:"author-avatar",children:r?e.jsx("img",{src:r,alt:s}):e.jsx("div",{className:"avatar-placeholder",children:s?.charAt(0)?.toUpperCase()||"?"})}),e.jsxs("div",{className:"author-details",children:[e.jsx("h4",{className:"author-name",children:s||"匿名用户"}),e.jsx("span",{className:"message-time",children:a(c)})]})]})}),e.jsxs("div",{className:"message-content",children:[e.jsx("p",{children:l}),o.length>0&&e.jsx("div",{className:"message-tags",children:o.map((t,p)=>e.jsxs("span",{className:"tag",children:["#",t]},p))})]}),e.jsxs("div",{className:"message-actions",children:[e.jsxs(k,{variant:"ghost",size:"small",onClick:m,disabled:d,className:`like-btn ${D?"liked":""}`,children:[e.jsx("span",{className:"like-icon",children:D?"❤️":"🤍"}),e.jsx("span",{className:"like-count",children:y})]}),e.jsxs(k,{variant:"ghost",size:"small",onClick:()=>w(!u),className:"reply-btn",children:[e.jsx("span",{className:"reply-icon",children:"💬"}),"回复"]})]}),S.length>0&&e.jsxs("div",{className:"message-replies",children:[e.jsxs("h5",{className:"replies-title",children:["回复 (",S.length,")"]}),S.map((t,p)=>e.jsxs("div",{className:"reply-item",children:[e.jsxs("div",{className:"reply-author",children:[t.author,":"]}),e.jsx("div",{className:"reply-content",children:t.content}),e.jsx("div",{className:"reply-time",children:a(t.timestamp)})]},p))]}),u&&e.jsxs("form",{onSubmit:L,className:"reply-form",children:[e.jsx("textarea",{value:v,onChange:t=>x(t.target.value),placeholder:"写下你的回复...",className:"reply-textarea input-glass",rows:3,required:!0}),e.jsxs("div",{className:"reply-form-actions",children:[e.jsx(k,{type:"button",variant:"ghost",size:"small",onClick:()=>{w(!1),x("")},children:"取消"}),e.jsx(k,{type:"submit",variant:"primary",size:"small",disabled:!v.trim(),children:"发送回复"})]})]})]})},F=({messages:j=[],onLoadMore:N,onLike:b,onReply:i,currentUser:f,loading:u=!1,hasMore:w=!1,className:v=""})=>{const[x,d]=h.useState("latest"),[g,n]=h.useState("all"),[s,l]=h.useState(""),[c,y]=h.useState(j);h.useEffect(()=>{let a=[...j];switch(s.trim()&&(a=a.filter(t=>t.content.toLowerCase().includes(s.toLowerCase())||t.author.toLowerCase().includes(s.toLowerCase())||t.tags?.some(p=>p.toLowerCase().includes(s.toLowerCase())))),g){case"own":a=a.filter(t=>t.author===f?.name||f?.isAnonymous&&t.author==="匿名用户");break}switch(x){case"popular":a.sort((t,p)=>(p.likes||0)-(t.likes||0));break;case"oldest":a.sort((t,p)=>new Date(t.timestamp)-new Date(p.timestamp));break;default:a.sort((t,p)=>new Date(p.timestamp)-new Date(t.timestamp));break}y(a)},[j,s,x,g,f]);const D=a=>{l(a.target.value)},S=a=>{d(a)},o=a=>{n(a)},r=()=>{l(""),d("latest"),n("all")},m=a=>({latest:"最新",popular:"最热",oldest:"最早"})[a]||"最新",L=a=>({all:"全部",followed:"关注",own:"我的"})[a]||"全部";return j.length===0&&!u?e.jsx("div",{className:`message-list ${v}`,children:e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"💬"}),e.jsx("h3",{children:"还没有留言"}),e.jsx("p",{children:"成为第一个分享想法的人吧！"})]})}):e.jsxs("div",{className:`message-list ${v}`,children:[e.jsxs("div",{className:"message-toolbar",children:[e.jsx("div",{className:"search-section",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("input",{type:"text",value:s,onChange:D,placeholder:"搜索留言内容、作者或标签...",className:"search-input input-glass"}),e.jsx("span",{className:"search-icon",children:"🔍"})]})}),e.jsxs("div",{className:"filter-section",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"排序："}),e.jsx("div",{className:"filter-buttons",children:["latest","popular","oldest"].map(a=>e.jsx(k,{variant:x===a?"primary":"ghost",size:"small",onClick:()=>S(a),className:"filter-btn",children:m(a)},a))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{className:"filter-label",children:"筛选："}),e.jsx("div",{className:"filter-buttons",children:["all","followed","own"].map(a=>e.jsx(k,{variant:g===a?"primary":"ghost",size:"small",onClick:()=>o(a),className:"filter-btn",children:L(a)},a))})]}),(s||x!=="latest"||g!=="all")&&e.jsx(k,{variant:"outline",size:"small",onClick:r,className:"clear-filters-btn",children:"清除筛选"})]})]}),e.jsx("div",{className:"results-info",children:e.jsxs("span",{className:"results-count",children:["共 ",c.length," 条留言",s&&` · 搜索"${s}"`]})}),e.jsx("div",{className:"messages-container",children:c.length===0?e.jsxs("div",{className:"no-results",children:[e.jsx("div",{className:"no-results-icon",children:"🔍"}),e.jsx("h3",{children:"没有找到匹配的留言"}),e.jsx("p",{children:"试试调整搜索条件或筛选选项"}),e.jsx(k,{variant:"outline",size:"medium",onClick:r,children:"清除所有筛选"})]}):c.map((a,t)=>e.jsx(z,{message:a,onLike:b,onReply:i,currentUser:f,className:`message-item-${t}`},a.id||t))}),w&&e.jsx("div",{className:"load-more-section",children:e.jsx(k,{variant:"outline",size:"large",onClick:N,disabled:u,className:`load-more-btn ${u?"loading":""}`,children:u?"加载中...":"加载更多留言"})}),u&&e.jsxs("div",{className:"loading-indicator",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("div",{className:"spinner"})}),e.jsx("p",{children:"正在加载留言..."})]})]})},B=()=>{const[j,N]=h.useState([]),[b,i]=h.useState(!1),[f,u]=h.useState(!0),[w]=h.useState({name:"运动爱好者",avatar:null,id:"user_123"});h.useEffect(()=>{const n=[{id:"1",author:"小明",content:"今天跑了10公里，感觉超棒！运动真的是最好的解压方式，推荐大家都试试晨跑，空气清新，心情也会变得很好。",timestamp:new Date(Date.now()-18e5).toISOString(),likes:15,isLiked:!1,replies:[{author:"小红",content:"我也喜欢晨跑！一起组队吧",timestamp:new Date(Date.now()-12e5).toISOString()}],tags:["跑步","健康","晨练"],avatar:null},{id:"2",author:"健身达人",content:"刚从健身房回来，今天练的是胸肌和三头。感觉状态越来越好了，坚持真的很重要！💪",timestamp:new Date(Date.now()-72e5).toISOString(),likes:8,isLiked:!0,replies:[],tags:["健身","肌肉训练"],avatar:null},{id:"3",author:"瑜伽爱好者",content:"今天的瑜伽课特别棒，老师教了一些新的体式。瑜伽不仅能锻炼身体，还能让心灵得到平静。推荐大家尝试！",timestamp:new Date(Date.now()-18e6).toISOString(),likes:12,isLiked:!1,replies:[{author:"小李",content:"瑜伽确实很棒，我也在学",timestamp:new Date(Date.now()-144e5).toISOString()},{author:"运动小白",content:"请问有推荐的瑜伽教程吗？",timestamp:new Date(Date.now()-108e5).toISOString()}],tags:["瑜伽","放松","身心健康"],avatar:null},{id:"4",author:"匿名用户",content:"刚开始运动，有点累但是很充实。希望能坚持下去，大家有什么建议吗？",timestamp:new Date(Date.now()-288e5).toISOString(),likes:6,isLiked:!1,replies:[],tags:["新手","坚持"],avatar:null},{id:"5",author:"游泳教练",content:"游泳是全身运动，对关节压力小，特别适合想要减重和塑形的朋友。夏天游泳既锻炼又凉爽！",timestamp:new Date(Date.now()-432e5).toISOString(),likes:20,isLiked:!1,replies:[{author:"小王",content:"游泳确实很好，但是我不太会",timestamp:new Date(Date.now()-36e6).toISOString()}],tags:["游泳","减重","全身运动"],avatar:null}];N(n)},[]);const v=async n=>{try{i(!0),await new Promise(l=>setTimeout(l,1e3));const s={...n,id:Date.now().toString(),likes:0,isLiked:!1,replies:[]};N(l=>[s,...l])}catch(s){throw console.error("发布留言失败:",s),s}finally{i(!1)}},x=async n=>{try{N(s=>s.map(l=>l.id===n?{...l,isLiked:!l.isLiked,likes:l.isLiked?l.likes-1:l.likes+1}:l)),await new Promise(s=>setTimeout(s,500))}catch(s){console.error("点赞失败:",s),N(l=>l.map(c=>c.id===n?{...c,isLiked:!c.isLiked,likes:c.isLiked?c.likes+1:c.likes-1}:c))}},d=async(n,s)=>{try{const l={...s,id:Date.now().toString()};N(c=>c.map(y=>y.id===n?{...y,replies:[...y.replies||[],l]}:y)),await new Promise(c=>setTimeout(c,500))}catch(l){throw console.error("回复失败:",l),l}},g=async()=>{try{i(!0),await new Promise(s=>setTimeout(s,1e3));const n=[{id:`${Date.now()}-1`,author:"篮球小子",content:"今天和朋友们打了两小时篮球，出了一身汗，感觉真爽！",timestamp:new Date(Date.now()-1e3*60*60*24).toISOString(),likes:3,isLiked:!1,replies:[],tags:["篮球","团队运动"],avatar:null},{id:`${Date.now()}-2`,author:"登山客",content:"周末爬山看日出，虽然累但是风景真的很美。运动让我们更接近大自然！",timestamp:new Date(Date.now()-1e3*60*60*30).toISOString(),likes:7,isLiked:!1,replies:[],tags:["登山","户外","日出"],avatar:null}];N(s=>[...s,...n]),j.length>15&&u(!1)}catch(n){console.error("加载更多失败:",n)}finally{i(!1)}};return e.jsx(A,{backgroundIntensity:"light",className:"message-wall-page",children:e.jsxs("div",{className:"message-wall-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{className:"page-title gradient-text",children:"🏃‍♂️ 运动留言墙"}),e.jsx("p",{className:"page-subtitle",children:"分享你的运动心得，与伙伴们一起成长"})]}),e.jsxs("div",{className:"message-wall-content",children:[e.jsx(O,{onSubmit:v,currentUser:w,className:"message-form-section"}),e.jsx(F,{messages:j,onLoadMore:g,onLike:x,onReply:d,currentUser:w,loading:b,hasMore:f,className:"message-list-section"})]}),e.jsxs("div",{className:"page-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-number",children:j.length}),e.jsx("span",{className:"stat-label",children:"条留言"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-number",children:j.reduce((n,s)=>n+(s.replies?.length||0),0)}),e.jsx("span",{className:"stat-label",children:"条回复"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-number",children:j.reduce((n,s)=>n+(s.likes||0),0)}),e.jsx("span",{className:"stat-label",children:"个点赞"})]})]})]})})};export{B as default};
